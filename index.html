<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o de Empr√©stimos - Relat√≥rio Mensal</title>
    <style>
        :root {
            --bg: #0d1117;
            --card: #161b22;
            --muted: #8b949e;
            --accent: #0ea5a4;
            --primary: #1e3a8a;
            --danger: #ef4444;
            --success: #10b981;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.06);
            --white: #e6edf3;
            --shadow-lg: 0 10px 30px rgba(2, 6, 23, 0.7);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--white);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
        }

        .header {
            background: var(--glass);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .header h1 {
            color: var(--accent);
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: var(--muted);
            font-size: 16px;
            font-weight: 500;
        }

        .header .date {
            color: var(--muted);
            font-size: 13px;
            margin-top: 15px;
            opacity: 0.8;
        }

        .upload-section {
            border: 2px dashed var(--accent);
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            background: var(--glass);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 30px;
        }

        .upload-section:hover {
            background: rgba(14, 165, 164, 0.05);
            border-color: var(--white);
            transform: translateY(-2px);
        }

        .upload-section.dragover {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success);
        }

        .upload-icon {
            font-size: 50px;
            color: var(--accent);
            margin-bottom: 20px;
            display: block;
        }

        .upload-text {
            font-size: 18px;
            color: var(--white);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 14px;
            color: var(--muted);
        }

        .report-container {
            display: none;
        }

        .report-container.visible {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: var(--glass);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 6px 18px rgba(2, 6, 23, 0.6);
            border: 1px solid var(--border);
            border-left: 6px solid var(--accent);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent);
        }

        .card-title {
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .card-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--white);
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
            margin: 40px 0 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
            background: var(--glass);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th {
            background: rgba(255, 255, 255, 0.02);
            color: var(--accent);
            font-weight: 600;
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
        }

        td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            color: var(--white);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.02);
        }

        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .font-bold { font-weight: 700; }

        .status-active { color: var(--success); font-weight: 600; }
        .status-danger { color: var(--danger); font-weight: 600; }
        
        .totals-row {
            background: rgba(14, 165, 164, 0.05) !important;
            font-weight: 700;
            border-top: 2px solid var(--border);
            border-bottom: 2px solid var(--border);
        }

        .totals-row td {
            color: var(--accent);
        }

        .toolbar {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-bottom: 25px;
        }

        .btn {
            padding: 10px 20px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--glass);
            color: var(--white);
        }

        .btn:hover {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .btn-success {
            border-color: var(--success);
            color: var(--success);
        }

        .btn-success:hover {
            background: var(--success);
            color: var(--bg);
        }

        .loading {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(13, 17, 23, 0.9);
            color: var(--white);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .loading.visible { display: flex; }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            border-radius: 8px;
            padding: 16px;
            color: var(--danger);
            margin-bottom: 20px;
            display: none;
            font-weight: 500;
        }

        .error-message.visible { display: block; }

        .footer {
            margin-top: 50px;
            padding: 30px 0;
            text-align: center;
            color: var(--muted);
            font-size: 12px;
            border-top: 1px solid var(--border);
        }

        .zoom-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--card);
            padding: 8px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 100;
            border: 1px solid var(--border);
        }

        .zoom-control button {
            background: var(--glass);
            border: 1px solid var(--border);
            color: var(--white);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .zoom-control button:hover {
            background: var(--accent);
            color: var(--bg);
        }

        @media print {
            body { background: white; color: black; padding: 0; }
            .container { box-shadow: none; border: none; width: 100%; max-width: none; }
            .upload-section, .toolbar, .zoom-control { display: none; }
            .card { border: 1px solid #ddd; background: white; color: black; }
            .card-value, .card-title, th, td { color: black !important; }
            .table-container { border: 1px solid #ddd; }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <h3>Processando dados...</h3>
        <p style="margin-top: 10px;">S√≥ um momento...</p>
    </div>

    <div class="container">
        <div class="header">
            <h1>Relat√≥rio Financeiro</h1>
            <div class="subtitle">Relat√≥rio dos Estados</div>
            <div class="date" id="currentDate"></div>
        </div>

        <div class="upload-section" id="uploadArea">
            <div class="upload-icon">üìä</div>
            <div class="upload-text">Arraste sua planilha Excel (Formato .xlsm, .xlsx) ou clique para selecionar a planilha</div>
            <div class="upload-hint">A planilha deve conter a aba "Planilha Atual" com os dados</div>
            <input type="file" id="fileInput" accept=".xlsx,.xlsm" style="display: none;">
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="report-container" id="reportContainer">
            <div class="toolbar">
                <button class="btn btn-primary" onclick="exportToPDF()">
                    <span>üìÑ</span> PDF
                </button>
                <button class="btn btn-success" onclick="printReport()">
                    <span>üñ®Ô∏è</span> Imprimir
                </button>
                <button class="btn btn-primary" onclick="resetSystem()">
                    <span>üîÑ</span> Nova Planilha
                </button>
            </div>

            <div id="reportContent"></div>
            
            <div class="footer">
                Confidencial - Uso Interno<br>
                Gerado em: <span id="generatedDateTime"></span>
            </div>
        </div>
    </div>

    <div class="zoom-control">
        <button onclick="zoomOut()" style="padding: 5px 10px; cursor: pointer;">‚àí</button>
        <span id="zoomLevel" style="padding: 0 10px;">85%</span>
        <button onclick="zoomIn()" style="padding: 5px 10px; cursor: pointer;">+</button>
    </div>

    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script>


        const SHEET_NAME_DATA = "Planilha Atual";
        const CUTOFF_DAY = 12;
        
        const COL = { 
            CLIENTE: 0,     
            DATA_INICIAL: 4,
            DATA_FINAL: 5,  
            EMPRESTIMO: 6,  
            TOTAL_PAGAR: 9,  
            VALOR_PAGO: 10,  
            DIARIAS: 14,     
            OBSERVACAO: 15,  
            STATUS_CLI: 16,  
            DATA_ATUAL: 17   
        };

        let monthlyData = {};
        let currentZoom = 85;
        let stats = { totalLinhas: 0, linhasProcessadas: 0, linhasIgnoradas: 0, statusCount: {} };

        document.addEventListener('DOMContentLoaded', () => {
            updateDateTime();
            setupEventListeners();
            setInterval(updateDateTime, 1000);
            document.getElementById('zoomLevel').textContent = currentZoom + '%';
        });

        function setupEventListeners() {
            const area = document.getElementById('uploadArea');
            const input = document.getElementById('fileInput');
            
            area.onclick = () => input.click();
            area.ondragover = (e) => { e.preventDefault(); area.classList.add('dragover'); };
            area.ondragleave = () => area.classList.remove('dragover');
            area.ondrop = (e) => { 
                e.preventDefault(); 
                area.classList.remove('dragover'); 
                if(e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]); 
            };
            input.onchange = (e) => { if(e.target.files.length) handleFile(e.target.files[0]); };
        }

        function handleFile(file) {
            showLoading();
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const workbook = XLSX.read(new Uint8Array(e.target.result), { type: 'array' });
                    if (!workbook.SheetNames.includes(SHEET_NAME_DATA)) {
                        throw new Error(`Aba '${SHEET_NAME_DATA}' n√£o encontrada.`);
                    }
                    
                    const worksheet = workbook.Sheets[SHEET_NAME_DATA];
                    const data = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
                    
                    processData(data);
                    
                    if (Object.keys(monthlyData).length > 0) {
                        document.getElementById('reportContainer').classList.add('visible');
                        generateReport();
                    } else {
                        showError('Nenhum dado v√°lido encontrado para processar.');
                    }
                } catch (err) { 
                    showError(err.message); 
                }
                hideLoading();
            };
            reader.readAsArrayBuffer(file);
        }

        function processData(rows) {
            monthlyData = {};
            stats = { totalLinhas: rows.length - 1, linhasProcessadas: 0, linhasIgnoradas: 0, statusCount: {} };
            const hoje = new Date();
            
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                
                if (!row || row.length < 5) { 
                    stats.linhasIgnoradas++; 
                    continue; 
                }

                const dataRefPeriodo = parseExcelDate(row[COL.DATA_INICIAL]);
                const periodo = extractPeriodo(dataRefPeriodo);
                
                if (periodo === 'Sem Data') { 
                    stats.linhasIgnoradas++; 
                    continue; 
                }

                const valorEmprestado = getNum(row[COL.EMPRESTIMO]);
                const valorPrevisto = getNum(row[COL.TOTAL_PAGAR]);
                const valorPago = getNum(row[COL.VALOR_PAGO]);
                
                const lucro = valorPago > valorPrevisto ? valorPago - valorPrevisto : 0;
                const saldoAberto = valorPrevisto > valorPago ? valorPrevisto - valorPago : 0;

                const status = determinarStatusFinal(row, dataRefPeriodo, hoje, valorPrevisto, valorPago);

                if (!monthlyData[periodo]) {
                    monthlyData[periodo] = {
                        totalEmprestado: 0, totalPrevisto: 0, totalPago: 0, 
                        totalLucro: 0, totalSaldoAberto: 0,
                        emprestadoAte12: 0, previstoAte12: 0, pagoAte12: 0,
                        status: { 
                            'ATIVO': 0, 
                            'N√ÉO EMPRESTAR': 0, 
                            'QUITADO': 0, 
                            'AMARELADO': 0, 
                            'COBRAR': 0, 
                            'CLIENTE EM ACORDO': 0, 
                            'VERDE': 0 
                        }
                    };
                }

                const p = monthlyData[periodo];
                p.totalEmprestado += valorEmprestado;
                p.totalPrevisto += valorPrevisto;
                p.totalPago += valorPago;
                p.totalLucro += lucro;
                p.totalSaldoAberto += saldoAberto;

                if (dataRefPeriodo && dataRefPeriodo.getDate() <= CUTOFF_DAY) {
                    p.emprestadoAte12 += valorEmprestado;
                    p.previstoAte12 += valorPrevisto;
                    p.pagoAte12 += valorPago;
                }

                if (p.status[status] !== undefined) {
                    p.status[status]++;
                } else {
                    p.status['ATIVO']++;
                }
                
                stats.linhasProcessadas++;
                stats.statusCount[status] = (stats.statusCount[status] || 0) + 1;
            }
        }

        function determinarStatusFinal(linha, dataRef, hoje, valorPrevisto, valorPago) {
            const colO_Diarias = getNum(linha[COL.DIARIAS]);
            const colP_Obs = String(linha[COL.OBSERVACAO] || '').toLowerCase().trim();
            const colF_DataFinal = parseExcelDate(linha[COL.DATA_FINAL]);
            const colR_DataAtual = parseExcelDate(linha[COL.DATA_ATUAL]);
            
            if (colP_Obs.includes('acordo')) return 'CLIENTE EM ACORDO';
            if (colO_Diarias === 20) return 'VERDE';
            
            if (colF_DataFinal && colR_DataAtual && colO_Diarias !== 20) {
                const diffTempo = colR_DataAtual - colF_DataFinal;
                const diffDias = Math.ceil(diffTempo / (1000 * 60 * 60 * 24));
                
                if (diffDias >= 90) return 'COBRAR';
                if (diffDias >= 1) return 'AMARELADO';
            }
            
            const statusTxt = String(linha[COL.STATUS_CLI] || '').toUpperCase();
            if (statusTxt.includes('N√ÉO') || statusTxt.includes('NAO')) return 'N√ÉO EMPRESTAR';
            if (valorPago >= valorPrevisto && valorPrevisto > 0) return 'QUITADO';
            
            return 'ATIVO';
        }

        function parseExcelDate(val) {
            if (!val) return null;
            try {
                if (val instanceof Date) return val;
                if (typeof val === 'number') {
                    const d = XLSX.SSF.parse_date_code(val);
                    if (d) return new Date(d.y, d.m - 1, d.d);
                }
                if (typeof val === 'string') {
                    if (val.includes('/')) {
                        const p = val.split('/');
                        if (p.length === 3) return new Date(p[2], p[1] - 1, p[0]);
                    }
                    const d = new Date(val);
                    if (!isNaN(d.getTime())) return d;
                }
            } catch (e) {}
            return null;
        }

        function extractPeriodo(date) {
            if (!date) return 'Sem Data';
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
        }

        function getNum(v) {
            if (v === null || v === undefined || v === '') return 0;
            if (typeof v === 'number') return v;
            try {
                let cleaned = String(v).replace(/[R$\s]/g, '').replace(/\./g, '').replace(',', '.');
                let n = parseFloat(cleaned);
                return isNaN(n) ? 0 : n;
            } catch (e) { return 0; }
        }

        function formatCurrency(value) {
            return 'R$ ' + value.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        function formatPeriodoLabel(periodo) {
            if (periodo === 'Sem Data') return 'SEM DATA';
            const [ano, mes] = periodo.split('-');
            const meses = ['JANEIRO', 'FEVEREIRO', 'MAR√áO', 'ABRIL', 'MAIO', 'JUNHO', 'JULHO', 'AGOSTO', 'SETEMBRO', 'OUTUBRO', 'NOVEMBRO', 'DEZEMBRO'];
            return `${meses[parseInt(mes) - 1]} ${ano}`;
        }

        function generateReport() {
            const periodos = Object.keys(monthlyData).sort();
            let totaisGerais = { emprestado: 0, pago: 0, saldo: 0, lucro: 0, emprestadoAte12: 0, previstoAte12: 0, pagoAte12: 0, totalPrevisto: 0 };
            let totaisStatus = { 'ATIVO': 0, 'AMARELADO': 0, 'COBRAR': 0, 'CLIENTE EM ACORDO': 0, 'VERDE': 0 };

            let html = `
                <div class="card-grid">
                    <div class="card" style="border-left-color: #7030A0;"><div class="card-title">Total Emprestado</div><div class="card-value">${formatCurrency(periodos.reduce((acc, p) => acc + monthlyData[p].totalEmprestado, 0))}</div></div>
                    <div class="card" style="border-left-color: #28A745;"><div class="card-title">Total Pago</div><div class="card-value">${formatCurrency(periodos.reduce((acc, p) => acc + monthlyData[p].totalPago, 0))}</div></div>
                    <div class="card" style="border-left-color: #E74C3C;"><div class="card-title">Saldo em Aberto</div><div class="card-value">${formatCurrency(periodos.reduce((acc, p) => acc + monthlyData[p].totalSaldoAberto, 0))}</div></div>
                    <div class="card" style="border-left-color: #28A745;"><div class="card-title">Lucro/Excedente</div><div class="card-value">${formatCurrency(periodos.reduce((acc, p) => acc + monthlyData[p].totalLucro, 0))}</div></div>
                </div>

                <div class="section-title">AN√ÅLISE FINANCEIRA POR PER√çODO</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="text-left">PER√çODO</th>
                                <th class="text-right">EMPREST. (at√© dia 12)</th>
                                <th class="text-right">PREVISTO (at√© dia 12)</th>
                                <th class="text-right">PAGO (at√© dia 12)</th>
                                <th class="text-right">TOTAL EMPRESTADO</th>
                                <th class="text-right">TOTAL PREVISTO</th>
                                <th class="text-right">VALOR PAGO (TOTAL)</th>
                                <th class="text-right">LUCRO/EXCEDENTE</th>
                                <th class="text-right">SALDO EM ABERTO</th>
                            </tr>
                        </thead>
                        <tbody>`;

            periodos.forEach(periodo => {
                const p = monthlyData[periodo];
                html += `<tr>
                    <td class="text-left font-bold">${formatPeriodoLabel(periodo)}</td>
                    <td class="text-right">${formatCurrency(p.emprestadoAte12)}</td>
                    <td class="text-right">${formatCurrency(p.previstoAte12)}</td>
                    <td class="text-right">${formatCurrency(p.pagoAte12)}</td>
                    <td class="text-right">${formatCurrency(p.totalEmprestado)}</td>
                    <td class="text-right">${formatCurrency(p.totalPrevisto)}</td>
                    <td class="text-right">${formatCurrency(p.totalPago)}</td>
                    <td class="text-right">${formatCurrency(p.totalLucro)}</td>
                    <td class="text-right">${formatCurrency(p.totalSaldoAberto)}</td>
                </tr>`;
                
                totaisGerais.emprestado += p.totalEmprestado; totaisGerais.totalPrevisto += p.totalPrevisto; totaisGerais.pago += p.totalPago;
                totaisGerais.lucro += p.totalLucro; totaisGerais.saldo += p.totalSaldoAberto;
                totaisGerais.emprestadoAte12 += p.emprestadoAte12; totaisGerais.previstoAte12 += p.previstoAte12; totaisGerais.pagoAte12 += p.pagoAte12;
                Object.keys(p.status).forEach(s => { if(totaisStatus[s] !== undefined) totaisStatus[s] += p.status[s]; });
            });

            html += `<tr class="totals-row">
                <td class="text-left font-bold">TOTAIS</td>
                <td class="text-right">${formatCurrency(totaisGerais.emprestadoAte12)}</td>
                <td class="text-right">${formatCurrency(totaisGerais.previstoAte12)}</td>
                <td class="text-right">${formatCurrency(totaisGerais.pagoAte12)}</td>
                <td class="text-right">${formatCurrency(totaisGerais.emprestado)}</td>
                <td class="text-right">${formatCurrency(totaisGerais.totalPrevisto)}</td>
                <td class="text-right">${formatCurrency(totaisGerais.pago)}</td>
                <td class="text-right">${formatCurrency(totaisGerais.lucro)}</td>
                <td class="text-right">${formatCurrency(totaisGerais.saldo)}</td>
            </tr></tbody></table></div>

            <div class="section-title">RESUMO DE STATUS DOS CLIENTES</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th class="text-left">PER√çODO</th>
                            <th class="text-right">ATIVO</th>
                            <th class="text-right">AMARELO (1-89 dias)</th>
                            <th class="text-right">VERMELHO (>=90 dias)</th>
                            <th class="text-right">ACORDO (Laranja)</th>
                            <th class="text-right">VERDE (O=20)</th>
                            <th class="text-right">TOTAL</th>
                        </tr>
                    </thead>
                    <tbody>`;

            periodos.forEach(periodo => {
                const p = monthlyData[periodo];
                const totalLinhaVisivel = p.status['ATIVO'] + p.status['AMARELADO'] + p.status['COBRAR'] + p.status['CLIENTE EM ACORDO'] + p.status['VERDE'];
                html += `<tr>
                    <td class="text-left font-bold">${formatPeriodoLabel(periodo)}</td>
                    <td class="text-right status-active">${p.status['ATIVO']}</td>
                    <td class="text-right" style="color: #a0a000; font-weight: bold;">${p.status['AMARELADO']}</td>
                    <td class="text-right" style="color: #990100; font-weight: bold;">${p.status['COBRAR']}</td>
                    <td class="text-right" style="color: #FFA200; font-weight: bold;">${p.status['CLIENTE EM ACORDO']}</td>
                    <td class="text-right" style="color: #38B000; font-weight: bold;">${p.status['VERDE']}</td>
                    <td class="text-right font-bold">${totalLinhaVisivel}</td>
                </tr>`;
            });

            const totalStatusGeralVisivel = Object.values(totaisStatus).reduce((a, b) => a + b, 0);
            html += `<tr class="totals-row">
                <td class="text-left font-bold">TOTAIS</td>
                <td class="text-right">${totaisStatus['ATIVO']}</td>
                <td class="text-right">${totaisStatus['AMARELADO']}</td>
                <td class="text-right">${totaisStatus['COBRAR']}</td>
                <td class="text-right">${totaisStatus['CLIENTE EM ACORDO']}</td>
                <td class="text-right">${totaisStatus['VERDE']}</td>
                <td class="text-right">${totalStatusGeralVisivel}</td>
            </tr></tbody></table></div>`;

            document.getElementById('reportContent').innerHTML = html;
        }

        function updateDateTime() {
            const d = new Date().toLocaleString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            document.getElementById('currentDate').textContent = 'Gerado em ' + d;
            document.getElementById('generatedDateTime').textContent = d;
        }

        function showError(m) { const e = document.getElementById('errorMessage'); e.textContent = m; e.classList.add('visible'); setTimeout(() => e.classList.remove('visible'), 5000); }
        function showLoading() { document.getElementById('loading').classList.add('visible'); }
        function hideLoading() { document.getElementById('loading').classList.remove('visible'); }
        function resetSystem() { location.reload(); }
        function zoomIn() { if (currentZoom < 150) { currentZoom += 5; document.body.style.zoom = currentZoom + '%'; document.getElementById('zoomLevel').textContent = currentZoom + '%'; } }
        function zoomOut() { if (currentZoom > 50) { currentZoom -= 5; document.body.style.zoom = currentZoom + '%'; document.getElementById('zoomLevel').textContent = currentZoom + '%'; } }
    </script>
</body>
</html>
